<!DOCTYPE html>
<html>

<head>
  <title>ETP DIGITAL</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

  {% extends admin_base_template %}

  {% block body %}
  <button onclick="window.location.href = '{{ url_for('index') }}'">Criar formulário ETP /IN 40 e 94</button>

  <div class="row">
    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-xs-12">
      <h3>Documento Gerado</h3>
      <table class="table table-striped table-hover ">
        <thead>
          <tr>
            <th>Processo</th>
            <th>Usuário</th>
            <th>Nome do ETP - Data e Hora</th>
            <th>Baixar PDF</th>
            <th>Baixar CSV</th>
            <th>Editar</th>
            <th>Importar ComprasNet</th>

          </tr>
        </thead>
        <tbody>
          {% for etp in etp40 %}
          <tr>
            <td>{{etp.id}}</td>
            <td> Criador {{current_user.username}}</td>
            <td>ETP40_{{etp.date_created.strftime('%d/%m/%Y %H:%M:%S')}}</td>
            <td>
              <form action="{{ url_for('baixar_pdf') }}" method="POST">
                <input type="hidden" name="id_form" value="{{etp.id}}">
                <input type="hidden" name="status" value="editar">
                <button type="submit" class="btn btn-link invisible-button"><i class="fa fa-file-pdf-o fa-2x" aria-hidden="true" class="style-icon "></i></button>
              </form>
            </td>
            <td>
              <form action="{{ url_for('gerar_csv') }}" method="POST">
                <input type="hidden" name="id_form" value="{{etp.id}}">
                <input type="hidden" name="status" value="editar">
                <button type="submit" class="btn btn-link invisible-button"><i class="fa fa-file-excel-o fa-2x" aria-hidden="true" class="style-icon "></i></button>
              </form>
            </td>
            <td>
              <form action="{{ url_for('retomar_dados') }}" method="POST">
                <input type="hidden" name="id_form" value="{{etp.id}}">
                <input type="hidden" name="status" value="editar">
                <button type="submit" class="btn btn-link invisible-button"><i class="fa fa-pencil-square-o fa-2x" aria-hidden="true" class="style-icon "></i></button>
              </form>
            </td>
            <td>
              <form action="{{ url_for('retomar_dados_import') }}" method="POST">
                <input type="hidden" name="id_form" value="{{etp.id}}">
                <input type="hidden" name="status" value="editar">
                <button type="submit" class="btn btn-link invisible-button"><i class="fa fa-external-link fa-2x" aria-hidden="true" class="style-icon "></i></button>
              </form>
            </td>
          </tr>
          {% endfor %}
          {% for etp in etp94 %}
          <tr>
            <td>{{etp.id}}</td>
            <td> Criador {{current_user.username}}</td>
            <td>ETP94_{{etp.date_created.strftime('%d/%m/%Y %H:%M:%S')}}</td>

            <td>
              <form action="{{ url_for('baixar_pdf_94') }}" method="POST">
                <input type="hidden" name="id_form" value="{{etp.id}}">
                <input type="hidden" name="status" value="editar">
                <button type="submit" class="btn btn-link invisible-button"><i class="fa fa-file-pdf-o fa-2x" aria-hidden="true" class="style-icon "></i></button>
              </form>
            </td>
            <td>
              <form action="{{ url_for('gerar_csv_94') }}" method="POST">
                <input type="hidden" name="id_form" value="{{etp.id}}">
                <input type="hidden" name="status" value="editar">
                <button type="submit" class="btn btn-link invisible-button"><i class="fa fa-file-excel-o fa-2x" aria-hidden="true" class="style-icon "></i></button>
              </form>
            </td>
            <td>
              <form action="{{ url_for('retomar_dados_94') }}" method="POST">
                <input type="hidden" name="id_form" value="{{etp.id}}">
                <input type="hidden" name="status" value="editar">
                <button type="submit" class="btn btn-link invisible-button"><i class="fa fa-pencil-square-o fa-2x" aria-hidden="true" class="style-icon "></i></button>
              </form>
            </td>
            <td>
              <form action="#" method="POST">
                <button type="button" id='btn-login' class="btn btn-link invisible-button"> oi<i class="fa fa-external-link fa-2x" aria-hidden="true" class="style-icon "></i></button>
              </form>
            </td>

  <script>
    // Função para enviar o formulário de login
    function enviarFormulario() {
      Swal.fire({
        title: 'Login',
        html: '<form id="login-form">' +
              //'<input type="hidden" name="id_form" value="{{etp.id}}">' +
              '<input type="text" id="username" class="swal2-input" placeholder="Usuário">' +
              '<input type="password" id="password" class="swal2-input" placeholder="Senha">' +
              '</form>',
        focusConfirm: false,
        preConfirm: () => {
          const username = $('#username').val();
          const password = $('#password').val();
          const id_form  = $('#id_form').val();
  
          // Enviar os dados de login para o backend (app.py) usando AJAX
          $.ajax({
            url: '/login_selenium',
            method: 'POST',
            data: { username: username, password: password },
            success: function (response) {
              // Se a autenticação for bem-sucedida, redireciona para a página do Selenium
              if (response.status === 'success') {
                window.location.href = '/pagina_selenium'; // Substitua '/pagina_selenium' pela rota correta do Selenium.
              } else {
                // Se a autenticação falhar, mostra uma mensagem de erro no SweetAlert2
                Swal.fire('Erro', 'Login ou senha inválidos', 'error');
              }
            },
            error: function (error) {
              console.error('Erro ao enviar dados de login:', error);
              Swal.fire('Erro', 'Ocorreu um erro no servidor', 'error');
            },
          });
        }
      });
    }
  
    // Adicionar o evento de clique ao botão para abrir o formulário de login
    document.getElementById('btn-login').addEventListener('click', enviarFormulario);
  </script>
  
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% endblock %}

</body>

</html>